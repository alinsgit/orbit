# Orbit v1.2.0 — Runtime Process Management + DX Polish

## Vizyon
"Your entire dev stack, beautifully managed." sözünü Node.js/Python/Bun/Deno/Go projeleri için de gerçek kılmak.

---

## Faz 1: Mimari Düzeltme — Site-Level Process Management

### Problem
Blueprint ile Node.js/Python sitesi oluşturunca nginx config hazır ama app process'i başlatılmıyor → 502 Bad Gateway.
PHP siteleri sorunsuz çünkü PHP-FPM zaten daemon olarak çalışıyor.

### Çözüm

**1.1 — Backend: SiteMetadata'ya `dev_command` alanı**
- Dosya: `core/src/services/site_store.rs`
- `SiteMetadata` struct'ına ekle:
  ```rust
  #[serde(default)]
  pub dev_command: Option<String>,  // "next dev", "bun dev", "python manage.py runserver"
  #[serde(default)]
  pub dev_port: Option<u16>,        // zaten var
  ```

**1.2 — Backend: Site process lifecycle**
- Dosya: `core/src/services/site_process.rs` (yeni)
- `start_site_app(domain)` → PTY'de `dev_command` çalıştır, PID takip et
- `stop_site_app(domain)` → PID'yi sonlandır
- `get_site_app_status(domain)` → running/stopped
- Process crash detection + otomatik restart (opsiyonel)

**1.3 — Frontend: Site kartına "Start App" butonu**
- Dosya: `app/components/SitesManager.tsx`
- `dev_command` olan sitelerde yeşil "Start App" / kırmızı "Stop App" butonu
- Status indicator (running dot / stopped dot)
- Log output'u terminal tab'ında göster

**1.4 — Blueprint entegrasyonu**
- Dosya: `core/src/mcp.rs` (`create_from_blueprint`)
- Blueprint `dev_command`'ı SiteMetadata'ya otomatik yaz:
  - nextjs-fullstack → `npm run dev`
  - sveltekit → `npm run dev`
  - remix → `npm run dev`
  - django → `python manage.py runserver 0.0.0.0:{{dev_port}}`
  - flask → `python -m flask run --port={{dev_port}}`
  - astro-static → `npm run dev`

**1.5 — Tauri komutları**
- `start_site_app` → site app process'ini başlat
- `stop_site_app` → site app process'ini durdur
- `get_site_app_status` → durum sorgula

**1.6 — MCP/CLI komutları**
- `orbit site start myapp.test` → dev_command'ı çalıştır
- `orbit site stop myapp.test` → process'i durdur
- MCP: `start_site_app`, `stop_site_app` tool'ları

---

## Faz 2: Mailpit ServiceType Bug Fix

**2.1 — ServiceType enum'a Mailpit ekle**
- Dosya: `core/src/services/process.rs`
- `ServiceType` enum'ına `Mailpit` variant'ı ekle
- `get_service_type()` match'ine ekle
- `get_port()`, `get_process_name()` fonksiyonlarına ekle

---

## Faz 3: Blueprint'leri GUI'ye Entegre Et

**3.1 — "Create from Blueprint" wizard**
- Dosya: `app/components/SitesManager.tsx` (veya yeni `BlueprintWizard.tsx`)
- Site oluşturma formuna "From Blueprint" tab'ı ekle
- Blueprint seç → domain/path gir → tek tıkla:
  - Gerekli servisleri başlat
  - Scaffold (npm init, composer create-project, vb.)
  - Nginx config oluştur
  - Hosts entry ekle
  - SSL oluştur (opsiyonel)
  - dev_command'ı kaydet
  - App process'ini başlat

**3.2 — 3 yeni template'i GUI template listesine ekle**
- `SiteTemplate` type'ına `django`, `sveltekit`, `remix` ekle
- `TEMPLATE_INFO` ve `PHP_TEMPLATES` güncelle

---

## Faz 4: MCP DB Güçlendirme

**4.1 — Parameterized queries**
- `execute_query` tool'una `params` parametresi ekle
- `:name` placeholder → prepared statement

**4.2 — Schema introspection**
- `describe_table` tool'unu genişlet: relation, index, foreign key bilgisi
- Veya yeni `get_table_schema` tool'u

**4.3 — Tablo filtreleme**
- `filter_table_names` tool'u (mysql-db'deki gibi)

**4.4 — Tek DB bağlamı**
- `use_database` tool'u — sonraki sorguları tek DB'de çalıştır

---

## Faz 5: DX Polish

**5.1 — MCP/CLI auto-update**
- GitHub API'den latest release kontrol et
- "Update Available" badge göster
- Tek tıkla güncelle (kaldır + indir)

**5.2 — Version string'lerini otomatikleştir**
- `build.rs` veya `env!("CARGO_PKG_VERSION")` ile Cargo.toml'dan çek
- cli.rs ve mcp.rs'teki hardcoded string'leri kaldır

**5.3 — MongoDB native Quick Manage**
- Database tab'da MongoDB için de Quick Manage desteği

---

## Öncelik Sırası
1. **Faz 1** (P0) — Mimari düzeltme, kırık deneyimi düzelt
2. **Faz 2** (P0) — Küçük bug fix, hızlı
3. **Faz 3** (P1) — Blueprint GUI, Faz 1'e bağımlı
4. **Faz 4** (P1) — MCP DB, bağımsız
5. **Faz 5** (P2) — Polish, bağımsız

## Dosya Etki Analizi
- **Yeni**: `core/src/services/site_process.rs`, `app/components/BlueprintWizard.tsx`
- **Ağır değişiklik**: `SitesManager.tsx`, `mcp.rs`, `cli.rs`, `site_store.rs`
- **Hafif değişiklik**: `process.rs`, `templates.rs`, `db-api.ts`, `DatabaseViewer.tsx`
- **Tauri komutları**: `core/src/commands/sites.rs` (3 yeni komut)
